---
layout: post
title: Linux用户管理
date: 2020-12-02
categories:
- Linux
---

用户管理的几大方面:<br>

>1. 添加用户
>2. 删除用户
>3. 密码管理
>4. 修改属性

---

## 添加用户
命令 `useradd`<br>

参考文件:
* /etc/default/useradd
* /etc/login.defs
* /etc/skel/*

常用参数:<br>

>-u \| 为用户指定UID<br>
>-g \| 为用户指定初始组<br>
>-G \| 为用户指定扩展组(次要组)<br>
>-N \| 不给创建用户同名基本组<br>
>-c \| 添加用户描述<br>
>-d \| 为用户指定主文件夹(绝对路径)<br>
>-m \| 强制创建主文件夹<br>
>-M \| 强制不创建主文件夹<br>
>对于普通用户默认会创建主文件夹;<br>
>而对于系统用户则默认不给创建主文件夹<br>
>-r \| 创建系统用户<br>
>-s \| 指定用户的Shell<br>
>nologin作为shell的用户无法登录, 一般给系统用户指定/sbin/nologin<br>
>-e \| 指定用户过期的时间 YYYY-MM-DD<br>
>-l \| 用户永不失效<br>
>-f \| 从密码过期之日到用户永久失效的宽限时间<br>
>0则代表一旦密码过期, 同一时间该用户也会永久失效<br>

特殊参数:<br>

>-D \| 显示默认设置文件的内容(不使用参数创建用户的默认配置)<br>
>相关文件路径: /etc/default/useradd<br>
>
>>`GROUP=users`<br>
>>`HOME=/home`<br>
>>`INACTIVE=-1`<br>
>>`EXPIRE=`<br>
>>`SHELL=/bin/bash`<br>
>>`SKEL=/etc/skel`<br>
>>`CREATE_MAIL_SPOOL=no`<br>
>
>`GROUP`会给新创建的用户指定一个默认的用户组, <br>
>然而是否参考这条默认设置则会因采用的用户组机制的不同而有所区别!<br>
>
>>私有用户组机制: 不会参考GROUP这条配置;<br>
>>公有用户组机制: 会参考GROUP配置;<br>
>
>不同的Linux发行版会采用不同的用户组机制<br>
>RHEL, Fedora, CentOS 采用私有用户组机制, 添加新用户时不参考GROUP配置<br>
>而SuSE等发行版则使用公有用户组机制, 会把users这个公有组作为新用户的初始组<br>
>公有组users的成员, 其主文件夹默认权限是drwxr-xr-x<br>
>`HOME`主文件夹存放的目录<br>
>`INACTIVE`代表密码过期后的宽限时间<br>
>-1代表即使密码过期但永远不会失效, 随时可以使用原密码登录, 但可能会强制修改密码才能继续使用;<br>
>0代表密码过期后立即就失效, 在也不能使用原密码登录用户帐号了;<br>
>`EXPIRE`代表帐号失效日, 不管密码什么状态, 超过规定日期用户账户直接失效<br>
>`SHELL`代表默认Shell解释器<br>
>`SKEL`代表在创建用户主文件夹时参考的基准目录<br>
>这个目录下的所以东西, 新用户的主文件夹里也会复制一份<br>
>`CREATE_MAIL_SPOOL`代表是否创建邮件目录<br>
>邮件目录的位置: /var/spool/mail/用户名<br>

----

## 删除用户
命令 `userdel`<br>

需要删除的数据都在哪里?<br>
* 用户和密码信息: /etc/passwd 和 /etc/shadow
* 用户组和组密码信息: /etc/group 和 /etc/gshadow
* 用户个人数据: /home/用户名
* 用户邮件信息: /var/spool/mail/用户名

常用参数:<br>

>-r \| 连主文件夹一起删除<br>
>-f \| 强制删除<br>

注意删除用户这个操作比较禁忌, 一般来说可以利用很多别的方式让用户不能使用, 但是该用户的数据资料还能留下, 只有万分确定不需要这个用户时才建议彻底删除!!!<br>
删除之前建议确认用户的文件对你来说是否重要 `find / -user 用户名`<br>

----
## 密码管理

命令 `passwd`<br>

常用参数:<br>

>-l \| 锁定用户, 密码失效, 不允许登录<br>
>-u \| 解锁用户, 允许登录<br>
>\--stdin \| 允许通过标准输入的形式修改密码<br>
>使用标准输入设置新密码只需要一次即可<br>
>-d \| 允许用户使用空密码登录<br>
>-n \| 不能修改密码的天数<br>
>-x \| 必须要修改密码的天数<br>
>-w \| 密码过期提前提醒的天数<br>
>-i \| 密码失效日期<br>
>-S \| 列出密码的相关参数(/etc/shadow的大部分信息)<br>

注意: passwd后面不加用户名就是在修改自己的密码<br>

密码强度校验模块 `PAM`<br>
管理机制在/etc/pam.d/passwd文件当中, pam_cracklib.so就是密码测试模块<br>

想要显示更详细的密码参数信息, <br>
推荐使用 `chage` 命令<br>

常用参数:<br>

>-l \| 列出用户的详细密码信息<br>
>-d \| 最近一次修改密码的日期, YYYY-MM-DD<br>
>-E \| 用户失效日期, YYYY-MM-DD<br>
>-I \| 密码失效日期<br>
>-m \| 密码最短保留天数<br>
>-M \| 密码需要修改的天数<br>
>-W \| 密码过期前提前警告的日期<br>

不想知道用户的密码, 但是又要求用户第一次登录必须设置密码的办法:<br>
1. 设置用户的时候给一个同名密码
```shell
echo "auser" | passwd --stdin auser
```
2. 把该用户的最近一次修改密码的日期设置为1970-1-1
```shell
chage -d 0 auser
```

----
## 修改属性
命令 `usermod`<br>

常用参数:<br>

>-c \| 用户描述<br>
>-d \| 主文件夹路径<br>
>-e \| 密码失效日期 YYYY-MM-DD<br>
>-f \| 密码过期之后的宽限天数<br>
>-g \| 用户初始组<br>
>-G \| 用户扩展组<br>
>-a \| 和-G一起用, 追加扩展组而非整体修改<br>
>-l \| 用户名<br>
>-s \| shell解释器<br>
>-u \| UID<br>
>-L \| 冻结用户密码, 使其无法登录<br>
>-U \| 解冻用户的密码<br>

----

## 普通用户常用的账户查询和修改命令

* `finger` "用户指纹"
	* 用来查询用户信息
	* 常用参数:
		* -s \| 仅列出帐号, 全名, 终端机代号和登录时间等;
		* -m \| 列出与帐号相同者
* `chfn` 
	* 设置一些其他信息
	* 常用参数:
		* -f \| 用户全名
		* -o \| Office
		* -p \| Offiec Phone
		* -h \| Home Phone
* `chsh`
	* 设置用户自己的Shell
	* 常用参数:
		* -l \| 列出所有可用Shell (/etc/shells)
		* -s \| 设置自己的Shell
* `id`
	* 查询自己或某个用户的UID/GID等信息






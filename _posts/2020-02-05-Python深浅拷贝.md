---
layout: post
title: Python深浅拷贝
date: 2020-02-05
categories:
- python
---

copy.copy -- 浅拷贝: 只拷贝顶层结构<br>
copy.deepcopy -- 深拷贝: 拷贝对象的全部层次结构<br>

### 浅拷贝
```python
tmp = [4, 5]
a1 = [1, 2, 3, tmp]
a2 = copy.copy(a1)
# 更改元素
a1[0] = 111
a1[-1][-1] = 555
print(a1, a2)
# a2中的列表[4, 5]中的元素发生了改变
>>> [111, 2, 3, [4, 555]] [1, 2, 3, [4, 555]]
print(id(a1), id(a2))
```
* a2使用浅拷贝拷贝了a1的1, 2, 3和对象tmp的地址;<br>
* 所以当a1中的1改为111时, a2并没有受到影响, 因为元素1属于顶层结构;<br>
* 但是tmp对象的底层结构元素5, 就会受到a1中改变的影响, 因为tmp指向的那个内存地址是一样的, 所以5改为555自然也就会反映到a2<br>


### 深拷贝
```python
tmp = [4, 5]
a1 = [1, 2, 3, tmp]
a2 = copy.deepcopy(a1)
a1[0] = 111
a1[-1][-1] = 555
print(a1, a2)
>>> [111, 2, 3, [4, 555]] [1, 2, 3, [4, 5]]
print(id(a1), id(a2))
```
* 深拷贝会拷贝对象的全部层级, 完整的复制tmp对象, 并给予的一个新的内存地址
* 深拷贝相当于是和原对象是完全不关联的另一个独立对象

### 可变不可变的深浅拷贝

1. 全部都是不可变元素的不可变对象<br>
例: `(1, 2, (3, 4, 5))`<br>
深拷贝/浅拷贝都相当与是赋值操作<br>

2. 含有不可变元素的可变对象<br>
例: `[1, 2, (3, 4, 5)]`<br>
深拷贝/浅拷贝都拷贝的是顶层结构<br>
因为没有更深的层级了<br>

3. 含有可变元素的不可变对象<br>
例: `(1, 2, [3, 4, 5])`<br>
浅拷贝变为引用; 深拷贝则拷贝全部层级<br>



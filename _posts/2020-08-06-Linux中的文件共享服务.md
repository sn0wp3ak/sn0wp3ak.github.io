---
layout: post
title: Linux中的文件共享服务
date: 2020-08-06
categories:
- linux
tags:
- smb
---

SMB
* Server Messages Block
* 服务器消息块

基于SMB协议开发了SMBServer后更名为Samba<br>
> yum install samba<br>

`Samba服务的目的主要是解决Linux和Windows之间的文件共享问题`, 当然在Linux和Linux之间也可以使用<br>

Samba服务的主配置文件: `/etc/samba/smb.conf`<br>
同样的如果我们需要一个比较清爽的配置文件, 可以备份以后重写原来的配置文件<br>
反选过滤掉以"#"和";"开头的注释行内容, 以及用"^$"反选过滤掉空白行<br>
```
mv /etc/samba/smb.conf /etc/samba/smb.conf.bak
cat /etc/samba/smb.conf.bak | grep -v "#" | grep -v ";" | grep 
-v "^$" > /etc/samba/smb.conf
```
### 配置共享
Samba服务也有全局配置和局部配置<br>
创建共享资源的方法: 修改配置文件参数+重启服务<br>

设置Samba服务的常用参数:<br>

| 参数                                                  | 作用             |
| :-                                                    | :-               |
| [data_dir]                                            | 共享名称         |
| comment = Do not arbitrarily modify the database file | 注释警告         |
| path = /home/data_dir                                 | 共享目录的路径   |
| public = no                                           | 关闭"所有人可见" |
| writable = yes                                        | 允许写入         |

1. 创建用于访问共享资源的账户信息
	* RHEL 7 中Samba默认采用用户口令认证这种认证模式
	* 只有建立用户信息数据库以后才能使用这种认证模式
	* Samba服务的数据库要求`用户必须是在系统中实际存在的`
	* pdbedit用于管理Samba账户信息数据库, 格式: `pdbedit [参数] 账户`<br>
		* 第一次把账户信息写入Samba数据库时, 需要使用`-a`参数
		* pdbedit命令常用参数列表:
			* |参数|作用|
| :-        | :-                     |
| -a 用户名 | 创建Samba账户          |
| -x 用户名 | 删除Samba账户          |
| -L        | 列出账户列表           |
| -Lv       | 列出账户信息的详细列表 |

	```
pdbedit -a -u sn0wp3ak
	```
	
2. 创建用于资源共享的文件目录
* 共享目录的所有者和所属组变更
* 修改SELinux相关限制
```
mkdir /home/data_dir
chown -Rf sn0wp3ak:sn0wp3ak /home/data_dir
semanage fcontext -a -t samba_share_t /home/data_dir
restorecon -Rv /home/data_dir
```

3. 设置SELinux服务与策略
* 允许通过Samba服务访问普通用户家目录
```
getsebool -a | grep samba
samba_enable_home_dirs --> off
```
```
setsebool -P samba_enable_home_dirs --> on
```

4. 在Samba服务主配置文件中写入共享信息
	* `vim /etc/samba/smb.conf`<br>
```
[data_dir]
comment = Do not arbitrarily modify the database file
path = /home/data_dir
public = no
writable = yes
```	
	* [homes]和[prints]参数块的内容, 如果不需要可以手动删除

5. 重启Samba服务, 清空iptables防火墙策略
```
systemctl restart samba
systemctl enable samba
iptables -F
service iptables save
```

### 从Windows客户机访问Linux服务器部署的Samba服务
运行 \-\-> `\\服务器IP地址` \-\-> 在登录界面输入Samba数据库中存在的用户名和密码<br>

----

### Linux与Linux之间通过Samba服务实现文件共享
需要在客户端安装支持共享服务的软件包<br>
> yum install cifs-utils

1. 在客户端这边按照Samba服务的用户名, 密码, 共享域的顺序将相关信息写入到一个认证文件中<br>
```
vim auth.smb
```
```
username=sn0wp3ak
password=samba
domain=MYGROUP
```
```
# 仅root用户能够读写
chmod 600 auth.smb
```
2. 在客户端创建一个用于挂载Samba服务共享资源的目录, 并写入/etc/fstab
```
mkdir /data_dir
vim /etc/fstab
```
```
//服务器IP地址/data_dir /data_dir cifs credentials=/root/auth.smb 0 0
```
```
mount -a
```

----

### 网络文件系统
NFS
* Network File System
> yum install nfs-utils

NFS仅用于Linux和Linux之间的文件共享<br>

